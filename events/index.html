<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Peace Lutheran — Events</title>
  <link rel="icon" href="../images/favicon.png" type="image/png" />
  <style>
    :root {
      --primary: #0D348F;
      /* rgb(13,52,143) */
      --accent-gold: #F2C94C;
      --accent-light: #0D7BEF;
      --muted: #6B7280;
      --bg: #F7F9FC;
      --card: #FFFFFF;
      --radius: 4px;
      --max-width: 1100px;
      --container-pad: 20px;
      --shadow: 0 6px 20px rgba(13, 52, 143, 0.08);
      font-family: Georgia, "Times New Roman", Times, serif;
    }

    * {
      box-sizing: border-box
    }

    body {
      margin: 0;
      background: var(--bg);
      color: #111
    }

    .wrap {
      max-width: var(--max-width);
      margin: 28px auto;
      padding: 0 var(--container-pad)
    }

    /* Header */
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px
    }

    .logo {
      width: 56px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-weight: 700
    }

    nav {
      display: flex;
      align-items: center
    }

    nav a {
      margin-left: 18px;
      color: var(--primary);
      text-decoration: none;
      font-weight: 600
    }

    nav a:hover {
      text-decoration: underline;
    }

    /* ---------- NEW: dropdown nav styles ---------- */
    /* Use details/summary for accessible dropdown */
    nav details {
      position: relative;
      margin-left: 18px;
    }

    nav summary {
      list-style: none;
      cursor: pointer;
      font-weight: 600;
      color: var(--primary);
      margin: 0;
      padding: 0;
      outline: none;
      user-select: none;
    }

    /* remove default marker */
    nav summary::-webkit-details-marker {
      display: none;
    }

    /* simple caret */
    nav summary::after {
      content: " ▾";
      font-size: 0.9em;
      color: var(--primary);
      margin-left: 6px;
      transition: transform 160ms ease;
      display: inline-block;
    }

    nav details[open] summary::after {
      transform: rotate(-180deg);
    }

    /* dropdown menu */
    nav details>ul {
      position: absolute;
      top: calc(100% + 8px);
      left: 0;
      background: var(--card);
      box-shadow: var(--shadow);
      border-radius: 6px;
      padding: 8px 6px;
      min-width: 180px;
      z-index: 100;
      margin: 0;
      list-style: none;
    }

    nav details>ul li {
      padding: 8px 12px;
      white-space: nowrap;
    }

    nav details>ul li a {
      margin-left: 18px;
      color: var(--primary);
      text-decoration: none;
      font-weight: 600
    }

    nav details>ul li a:hover {
      text-decoration: underline;
    }


    /* === Calendar / Events layout === */
    main{padding: 8px 0 48px;}

    .calendar-section{margin-top:22px}
    .calendar-section h1{font-size:22px;color:var(--primary);margin:0 0 18px}

    /* Calendar container (full width card) */
    .calendar {
      width:100%;
      background:var(--card);
      border-radius:var(--radius);
      padding:12px;
      box-shadow:var(--shadow);
      margin-bottom:26px;
      overflow:hidden;
    }

    /* iframe sized responsively */
    .calendar iframe{
      width:100%;
      height:720px; /* large by default */
      border:0;
      display:block;
      border-radius:6px;
    }

    /* Events grid under the calendar */
    .events-grid{
      display:grid;
      grid-template-columns:repeat(3, 1fr);
      gap:18px;
    }

    .event-card{
      background:var(--card);
      border-radius:10px;
      padding:14px;
      box-shadow:var(--shadow);
      min-height:84px;
      display:flex;
      flex-direction:column;
      justify-content:center;
    }

    .event-card h3{
      margin:0 0 6px;
      font-size:16px;
      color:var(--primary);
      line-height:1.2;
    }

    .event-meta{
      color:var(--muted);
      font-size:14px;
    }

    /* small "no events" card */
    .no-events{
      text-align:center;
      padding:30px 14px;
      color:var(--muted);
      background:var(--card);
      border-radius:10px;
      box-shadow:var(--shadow);
    }

    /* footer */
    footer{
      padding:18px 0;
      border-top:1px solid #eee;
      background:transparent;
      margin-top:42px;
    }
    .footer-inner{
      display:grid;
      grid-template-columns:1fr auto 1fr;
      align-items:center;
      gap:12px;
      padding:0 var(--container-pad);
      max-width:100%;
    }
    .footer-center{justify-self:center;color:var(--muted);font-size:13px}
    .footer-right{justify-self:end}
    .footer-link{display:flex;gap:8px;align-items:center;text-decoration:none;color:var(--muted);font-size:13px}
    .footer-logo{height:28px;opacity:.8;transition:transform .16s,opacity .16s}

    /* Responsive breakpoints */
    @media (max-width:920px){
      .calendar iframe{height:600px}
      .events-grid{grid-template-columns:repeat(2,1fr)}
      .wrap{padding:0 16px}
    }
    @media (max-width:520px){
      .calendar iframe{height:460px}
      .events-grid{grid-template-columns:1fr}
      header{flex-direction:column;align-items:flex-start}
      nav{margin-top:8px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <img class="logo" src="../images/logo.png" alt="Peace Lutheran logo">
        <div>
          <div style="font-weight:800;color:var(--primary)">Peace Lutheran</div>
          <div style="font-size:12px;color:var(--muted)">A welcoming Lutheran congregation</div>
        </div>
      </div>
      <nav>
        <a href="/">Home</a>
        <a href="https://maps.app.goo.gl/FXUWn1VD3qzejPuw7">Visit</a>
        <a href="/#devotion">Daily Devotion</a>
        <a href="/#events">Calendar</a>
        <a href="/yoga/">Yoga</a>

        <!-- NEW: Other dropdown -->
        <details>
          <summary>Other</summary>
          <ul>
            <li><a href="/bible-studies/">Bible Studies</a></li>
            <li><a href="/sermons/">Sermons</a></li>
            <li><a href="/staff/">Staff</a></li>
          </ul>
        </details>
      </nav>
    </header>


    <main>
      <section class="calendar-section" aria-labelledby="events-heading">
        <h1 id="events-heading">Upcoming Events</h1>

        <!-- BIG CALENDAR ON TOP -->
        <div class="calendar" role="region" aria-label="Calendar">
          <!-- Replace calendar src if you need a different calendar -->
          <iframe
            src="https://calendar.google.com/calendar/embed?height=600&wkst=1&ctz=America%2FChicago&showPrint=1&showTitle=0&src=cGxjcGZsZEBnbWFpbC5jb20&color=%23039be5"
            title="Google Calendar embed"
            loading="lazy"
            ></iframe>
        </div>

        <!-- EVENTS GRID BELOW: will be populated by JS -->
        <div id="eventsGrid" class="events-grid" aria-live="polite" aria-busy="true">

        </div>

      </section>
    </main>

    <footer>
      <div class="footer-inner">
        <div></div>
        <div class="footer-center">© <span id="year">2026</span> Peace Lutheran Church — All rights reserved</div>
        <div class="footer-right">
          <a href="https://kaiserwebdesign.net" target="_blank" rel="noopener" class="footer-link">
            <img src="../images/KaiserWebDesignMutedLogo.png" alt="Kaiser Web Design" class="footer-logo" />
          </a>
        </div>
      </div>
    </footer>
  </div>

  <script>
    // ====== CONFIG ======
    // Replace GOOGLE_API_KEY with your key to fetch live events.
    // If you leave it as null or empty, the page will keep the fallback cards above.
    const GOOGLE_API_KEY = "AIzaSyAhavTXE_EbUKi9EKoNA0S8oct4fW983GU"; // <-- put your Google API key here (or leave empty to use fallback)
    const CALENDAR_ID = "plcpfld@gmail.com"; // calendar ID (public)

    // ====== Helpers ======
    const eventsGrid = document.getElementById('eventsGrid');
    const yearSpan = document.getElementById('year');
    yearSpan.textContent = new Date().getFullYear();

    function formatEventStart(start) {
      // handles all-day (date) and timed (dateTime) events
      if (start.date) {
        // all-day
        const [y, m, d] = start.date.split('-').map(s => parseInt(s,10));
        const dt = new Date(Date.UTC(y, m-1, d));
        // show month short + day
        return new Intl.DateTimeFormat('en-US', { month: 'short', day: 'numeric', timeZone: 'America/Chicago' }).format(dt);
      }
      if (start.dateTime) {
        const dt = new Date(start.dateTime);
        const datePart = new Intl.DateTimeFormat('en-US', { month: 'short', day: 'numeric', timeZone: 'America/Chicago' }).format(dt);
        const timePart = new Intl.DateTimeFormat('en-US', { hour: 'numeric', minute: '2-digit', hour12: true, timeZone: 'America/Chicago' }).format(dt);
        return `${datePart} — ${timePart}`;
      }
      return '';
    }

    function clearGrid() {
      eventsGrid.innerHTML = '';
    }

    function addEventCard(title, meta, url) {
      const card = document.createElement('article');
      card.className = 'event-card';
      if (url) {
        // Make the card clickable while keeping styles (accessible)
        const a = document.createElement('a');
        a.href = url;
        a.target = '_blank';
        a.rel = 'noopener';
        a.style.display = 'block';
        a.style.color = 'inherit';
        a.style.textDecoration = 'none';
        a.innerHTML = `<h3>${escapeHtml(title)}</h3><div class="event-meta">${escapeHtml(meta)}</div>`;
        card.appendChild(a);
      } else {
        card.innerHTML = `<h3>${escapeHtml(title)}</h3><div class="event-meta">${escapeHtml(meta)}</div>`;
      }
      eventsGrid.appendChild(card);
    }

    function escapeHtml(s) {
      return (s || '').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c]));
    }

    // Show a simple message card (used on errors / no events)
    function showMessageCard(message) {
      clearGrid();
      const div = document.createElement('div');
      div.className = 'no-events';
      div.textContent = message;
      eventsGrid.appendChild(div);
    }

    // ====== Fetch & render events (optional) ======
    async function loadCalendarEvents() {
      if (!GOOGLE_API_KEY) {
        // no key — keep fallback events already in the DOM
        eventsGrid.setAttribute('aria-busy','false');
        return;
      }

      const url = `https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(CALENDAR_ID)}/events` +
                  `?key=${encodeURIComponent(GOOGLE_API_KEY)}` +
                  `&singleEvents=true&orderBy=startTime&timeMin=${encodeURIComponent((new Date()).toISOString())}`;

      try {
        eventsGrid.setAttribute('aria-busy','true');
        const res = await fetch(url);
        if (!res.ok) throw new Error('Calendar fetch failed: ' + res.status);
        const data = await res.json();
        const items = Array.isArray(data.items) ? data.items : [];

        if (items.length === 0) {
          showMessageCard('No upcoming events');
          eventsGrid.setAttribute('aria-busy','false');
          return;
        }

        // Build event cards
        clearGrid();
        items.forEach(item => {
          const title = item.summary || 'Untitled event';
          const startText = formatEventStart(item.start || {});
          const htmlMeta = startText || (item.location ? item.location : '');
          // If the event has an htmlLink, link to it.
          addEventCard(title, htmlMeta, item.htmlLink);
        });

        eventsGrid.setAttribute('aria-busy','false');
      } catch (err) {
        console.error('Failed to load calendar events:', err);
        showMessageCard('Error loading events');
        eventsGrid.setAttribute('aria-busy','false');
      }
    }

    // Run loader (attempt to fetch; if no API key, keep fallback)
    loadCalendarEvents();
  </script>
</body>
</html>