<!doctype html>

<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Staff Slide — Peace Lutheran</title>
  <style>
    :root {
      --primary: #0D348F;
      --accent-gold: #F2C94C;
      --bg: #F7F9FC;
      --muted: #6B7280;
      --overlay: rgba(13, 52, 143, 0.42);
      --overlay-strong: rgba(13, 52, 143, 0.66);
      --white: #fff;
      --max-width: 1600px;
      --pad: 48px;
      --font-sans: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      --font-serif: Georgia, "Times New Roman", Times, serif;
    }

    /* Full-bleed, fixed layout for TV (landscape) */
    html,
    body {
      height: 100%;
      margin: 0;
      background: var(--bg);
      font-family: var(--font-serif);
      color: var(--white);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* Slide container covers the viewport */
    .slide {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      background: #000;
    }

    /* Background image (covers, centered) */
    .slide .bg {
      position: absolute;
      inset: 0;
      background-position: center center;
      background-size: cover;
      filter: saturate(0.96) contrast(0.9);
      transform: scale(1.03);
      will-change: transform, filter;
    }

    .slide.kb .bg {
      transition: transform 16s linear;
      transform-origin: center center;
    }

    .slide.kb.playing .bg {
      transform: scale(1.08) translateY(-2%);
    }

    .overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(180deg, rgba(0, 0, 0, 0.45) 0%, rgba(13, 52, 143, 0.18) 45%, rgba(0, 0, 0, 0.55) 100%);
      mix-blend-mode: normal;
    }

    .content {
      position: relative;
      z-index: 20;
      width: min(1100px, calc(100% - 160px));
      padding: 48px;
      box-sizing: border-box;
      display: flex;
      gap: 28px;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      text-shadow: 0 6px 22px rgba(2, 6, 23, 0.6);
      transition: opacity 600ms ease, transform 600ms ease;
      opacity: 1;
      transform: translateY(0);
      will-change: opacity, transform;
    }

    .content.fade-out {
      opacity: 0;
      transform: translateY(10px) scale(1.01);
      pointer-events: none;
    }

    .content.fade-in {
      opacity: 1;
      transform: translateY(0) scale(1);
    }

    .portrait {
      width: 420px;
      height: 420px;
      flex: 0 0 420px;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 18px 50px rgba(2, 6, 23, 0.6);
      border: 6px solid rgba(255, 255, 255, 0.06);
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.06), rgba(255, 255, 255, 0.02));
      display: block;
    }

    .portrait img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      transform: scale(1.01);
    }

    /* text block */
    .meta {
      color: var(--white);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      max-width: 720px;
    }

    .name {
      font-size: 72px;
      line-height: 0.95;
      margin: 0;
      font-weight: 800;
      letter-spacing: -0.02em;
      color: var(--white);
      font-family: var(--font-serif);
    }

    .role {
      font-size: 28px;
      margin: 0;
      color: var(--accent-gold);
      font-weight: 700;
      text-transform: none;
      letter-spacing: 0.02em;
    }

    .desc {
      font-size: 20px;
      color: rgba(255, 255, 255, 0.92);
      margin-top: 18px;
      line-height: 1.45;
      max-width: 900px;
    }

    .brand {
      position: absolute;
      top: 24px;
      left: 28px;
      z-index: 30;
      display: flex;
      gap: 12px;
      align-items: center;
      color: rgba(255, 255, 255, 0.9);
      font-weight: 700;
      font-family: var(--font-sans);
      text-shadow: none;
      font-size: 18px;
    }

    .brand img {
      height: 34px;
      width: auto;
      opacity: 0.95
    }

    .caption {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 30;
      color: rgba(255, 255, 255, 0.75);
      font-family: var(--font-sans);
      font-size: 14px;
    }

    .fade-wrap {
      transition: opacity 0.9s ease, transform 0.9s ease;
      opacity: 1;
    }

    .fade-out {
      opacity: 0;
      transform: scale(1.04);
    }

    .fade-in {
      opacity: 1;
      transform: scale(1);
    }

    .portrait img {
      transition: opacity 0.6s ease;
    }

    .name,
    .role,
    .desc {
      transition: opacity 0.6s ease, transform 0.6s ease;
    }


    @media (max-height:720px) {
      .portrait {
        width: 300px;
        height: 300px;
        flex-basis: 300px
      }

      .name {
        font-size: 56px
      }

      .role {
        font-size: 22px
      }

      .desc {
        font-size: 18px
      }
    }

    @media (min-aspect-ratio: 16/9) and (max-width:1400px) {
      .content {
        width: calc(100% - 120px)
      }
    }

    .slide.no-portrait .content {
      gap: 12px
    }

    .slide.no-portrait .portrait {
      display: none
    }

    .slide.no-portrait .name {
      font-size: 98px
    }
  </style>
</head>

<body>

  <div class="slide kb playing" id="slide">
    <div class="bg" id="bgEl" aria-hidden="true"></div>
    <div class="overlay" aria-hidden="true"></div>

    <div class="brand" aria-hidden="true">
      <img src="/images/logo.png" alt="" id="brandLogo" style="display:none">
      <div>Peace Lutheran</div>
    </div>

    <div class="content" role="region" aria-label="Staff spotlight">
      <figure class="portrait" id="portraitEl" aria-hidden="true">
        <img src="" alt="staff portrait" id="portraitImg">
      </figure>

      <div class="meta">
        <h1 class="name" id="nameEl">Name Placeholder</h1>
        <div class="role" id="roleEl">Role Placeholder</div>
        <div class="desc" id="descEl">Short role description or biography goes here. Keep it concise — this text will be
          displayed prominently on a TV and should be easy to read from a distance.</div>
      </div>
    </div>

    <div class="caption">Peace Lutheran Church • 24024 West Main Street — www.peacelutheran.org</div>
  </div>

  <script>
    const portraitImg = document.getElementById('portraitImg');
    const nameEl = document.getElementById('nameEl');
    const roleEl = document.getElementById('roleEl');
    const descEl = document.getElementById('descEl');
    const slide = document.getElementById('slide');
    const contentEl = document.querySelector('.content');

    let staffTable = [];
    let index = 0;
    let transitioning = false;
    const DISPLAY_MS = 12000;   // total time each card is visible
    const FADE_MS = 600;        // must match CSS transition duration

    // preload and check image loads
    function preloadImage(src) {
      return new Promise((resolve) => {
        if (!src) return resolve(false);
        const img = new Image();
        img.onload = () => resolve(true);
        img.onerror = () => resolve(false);
        img.src = src;
      });
    }

    // small timeout helper
    function wait(ms) { return new Promise(r => setTimeout(r, ms)); }

    function applyContent(obj) {
      // set portrait and text — portrait will appear instantly after fade
      portraitImg.src = obj.img;
      portraitImg.alt = obj.alt || obj.name || 'Staff portrait';
      nameEl.textContent = obj.name || '';
      roleEl.textContent = obj.role || '';
      descEl.textContent = obj.desc || '';
    }

    // show next with smooth fade-out -> swap -> fade-in
    async function showNext() {
      if (transitioning || staffTable.length === 0) return;
      transitioning = true;

      // compute next index but don't commit until transition finishes
      const nextIndex = (index + 1) % staffTable.length;
      const next = staffTable[nextIndex];

      // preload the next image so swap is instant
      await preloadImage(next.img);

      // fade out content (only content, not background)
      contentEl.classList.add('fade-out');

      // wait for fade-out to complete
      await wait(FADE_MS);

      // swap content
      applyContent(next);

      // remove fade-out and add fade-in class to trigger gentle pop
      contentEl.classList.remove('fade-out');
      contentEl.classList.add('fade-in');

      // wait for fade-in to finish
      await wait(FADE_MS);

      // cleanup and update index
      contentEl.classList.remove('fade-in');
      index = nextIndex;
      transitioning = false;
    }

    // Load staff.json, filter to only entries whose images actually load,
    // then start the slideshow.
    (async function init() {
      try {
        const res = await fetch('/staff.json');
        if (!res.ok) throw new Error('Failed to fetch staff.json: ' + res.status);
        const data = await res.json();

        const valid = [];
        for (const s of data) {
          if (!s.img || !s.img.trim()) continue;
          const ok = await preloadImage(s.img);
          if (ok) valid.push(s);
        }

        staffTable = valid;

        if (staffTable.length === 0) {
          console.warn('No valid staff entries with images found in staff.json');
          // Optionally show a fallback message or hide portrait
          slide.classList.add('no-portrait');
          return;
        }

        // initial content (ensure first image is loaded)
        applyContent(staffTable[0]);

        // start automatic rotation but ensure we wait DISPLAY_MS before first change
        setInterval(showNext, DISPLAY_MS);
      } catch (err) {
        console.error('Error initializing staff slide:', err);
      }
    })();
  </script>

</body>

</html>